<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Afya Center - Stock Management</title>
  <style>
    /* Modern Business Style */
    :root {
      --primary: #2b6cb0;
      --secondary: #2c5282;
      --accent: #4299e1;
      --success: #48bb78;
      --danger: #f56565;
      --warning: #ed8936;
      --dark: #1a202c;
      --light: #f7fafc;
      --gold: #d69e2e;
      --teal: #38b2ac;
      --purple: #9f7aea;
      --maroon: #800000;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f4f8;
      color: var(--dark);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: grid;
      grid-template-columns: 250px 1fr;
      grid-template-rows: auto 1fr;
      grid-template-areas:
        "header header"
        "sidebar content";
    }

    /* Header Styles */
    .header {
      grid-area: header;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10;
    }

    .header h1 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header h1 i {
      margin-right: 12px;
      color: var(--gold);
    }

    /* Sidebar Styles */
    .sidebar {
      grid-area: sidebar;
      background-color: white;
      border-right: 1px solid #e2e8f0;
      height: 100%;
      overflow-y: auto;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-menu li {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid #edf2f7;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-menu li:hover {
      background-color: #f0f4f8;
    }

    .sidebar-menu li.active {
      background-color: var(--primary);
      color: white;
    }

    .sidebar-menu li i {
      width: 20px;
      text-align: center;
    }

    /* Content Area */
    .content-area {
      grid-area: content;
      padding: 1.5rem;
      overflow-y: auto;
      background-color: #f7fafc;
    }

    /* Full Screen Content */
    .full-screen-content {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 100;
      padding: 1.5rem;
    }

    .full-screen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .full-screen-header h2 {
      margin: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .full-screen-header h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    /* Back Button */
    .back-button {
      position: absolute;
      top: 1.5rem;
      left: 1rem;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 50;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s;
      display: none; /* Hidden by default */
    }

    .back-button:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
    }

    /* Login Container */
    .login-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      width: 380px;
      margin: 3rem auto;
      padding: 2rem;
      text-align: center;
      border-top: 4px solid var(--gold);
    }

    .login-container h2 {
      color: var(--dark);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-container h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .error {
      color: var(--danger);
      background: rgba(245, 101, 101, 0.1);
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    input[type="text"], 
    input[type="password"], 
    input[type="date"], 
    textarea {
      width: 100%;
      padding: 0.875rem;
      margin-bottom: 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s;
    }

    input[type="text"]:focus, 
    input[type="password"]:focus, 
    input[type="date"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }

    /* Button Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.875rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .btn i {
      margin-right: 8px;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: #2c5282;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-success {
      background-color: var(--success);
      color: white;
    }

    .btn-success:hover {
      background-color: #38a169;
      transform: translateY(-2px);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: #e53e3e;
      transform: translateY(-2px);
    }

    .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background-color: #dd6b20;
      transform: translateY(-2px);
    }

    .btn-accent {
      background-color: var(--accent);
      color: white;
    }

    .btn-accent:hover {
      background-color: #3182ce;
      transform: translateY(-2px);
    }

    .btn-gold {
      background-color: var(--gold);
      color: white;
    }

    .btn-gold:hover {
      background-color: #b7791f;
      transform: translateY(-2px);
    }

    .btn-purple {
      background-color: var(--purple);
      color: white;
    }

    .btn-purple:hover {
      background-color: #805ad5;
      transform: translateY(-2px);
    }

    /* Stock Form */
    .stock-form-container {
      max-width: 1400px;
      margin: 0 auto;
      display: none; /* Hidden by default */
    }

    .stock-form {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #edf2f7;
    }

    .form-header h2 {
      margin: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .form-header h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .date-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .date-controls input[type="date"] {
      max-width: 180px;
    }

    .add-item-form {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px dashed #cbd5e0;
      display: none; /* Hidden by default */
    }

    .add-item-form h3 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: var(--dark);
      font-size: 1.2rem;
      display: flex;
      align-items: center;
    }

    .add-item-form h3 i {
      margin-right: 8px;
      color: var(--teal);
    }

    .form-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-row input {
      flex: 1;
      min-width: 0;
    }

    /* Category Sections */
    .category-section {
      margin-bottom: 2rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
    }

    .category-header {
      background-color: var(--primary);
      color: white;
      padding: 0.75rem 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .category-header i {
      margin-right: 8px;
    }

    .category-content {
      padding: 1rem;
      background-color: white;
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .stock-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .stock-table th {
      background-color: var(--primary);
      color: white;
      padding: 1rem;
      text-align: center;
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    .stock-table td {
      padding: 0.875rem;
      text-align: center;
      border-bottom: 1px solid #edf2f7;
      transition: background 0.2s;
    }

    .stock-table tr:hover td {
      background-color: #f8fafc;
    }

    .stock-table input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      text-align: center;
      transition: all 0.2s;
    }

    .stock-table input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
    }

    .stock-table input[readonly] {
      background-color: #f8fafc;
      border-color: #e2e8f0;
      color: #4a5568;
    }

    .delete-btn {
      background-color: var(--danger);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      margin: 0 auto;
    }

    .delete-btn:hover {
      background-color: #e53e3e;
      transform: scale(1.1);
    }

    /* Form Controls */
    .form-actions {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    /* User Info */
    .user-info {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: white;
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      z-index: 20;
      display: none; /* Hidden by default */
    }

    .user-info i {
      color: var(--primary);
    }

    /* Inventory Styles */
    .inventory-container {
      max-width: 1400px;
      margin: 0 auto;
      display: none;
    }

    .inventory-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .inventory-table th:nth-child(1) { width: 30%; }
    .inventory-table th:nth-child(2) { width: 15%; }
    .inventory-table th:nth-child(3) { width: 15%; }
    .inventory-table th:nth-child(4) { width: 15%; }
    .inventory-table th:nth-child(5) { width: 15%; }
    .inventory-table th:nth-child(6) { width: 10%; }

    /* Payment System Styles - Supermarket Style */
    .payment-container {
      max-width: 1400px;
      margin: 0 auto;
      display: none;
    }

    .payment-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
    }

    .payment-products-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 1.5rem;
    }

    .payment-cart-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
    }

    .payment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #edf2f7;
    }

    .payment-header h2 {
      margin: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .payment-header h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .product-categories {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .category-btn {
      background: #edf2f7;
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .category-btn.active {
      background: var(--primary);
      color: white;
    }

    .category-btn:hover {
      background: #e2e8f0;
    }

    .category-btn.active:hover {
      background: var(--secondary);
    }

    .payment-products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 1rem;
    }

    .payment-product-card {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      height: 100%;
    }

    .payment-product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-color: var(--accent);
    }

    .payment-product-card.selected {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .payment-product-card img {
      width: 50px;
      height: 50px;
      object-fit: contain;
      margin-bottom: 0.5rem;
    }

    .payment-product-card h3 {
      margin: 0 0 0.25rem 0;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .payment-product-card .product-size {
      font-size: 0.75rem;
      color: #718096;
      margin-bottom: 0.25rem;
    }

    .payment-product-card.selected .product-size {
      color: rgba(255, 255, 255, 0.8);
    }

    .payment-product-card .product-price {
      font-weight: 700;
      margin-top: auto;
      font-size: 0.9rem;
    }

    .payment-cart {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .payment-cart table {
      width: 100%;
      border-collapse: collapse;
    }

    .payment-cart th {
      text-align: left;
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid #e2e8f0;
      font-weight: 600;
    }

    .payment-cart td {
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: middle;
    }

    .payment-cart .quantity-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .payment-cart .quantity-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .payment-cart .quantity-btn:hover {
      background: var(--secondary);
    }

    .payment-cart .remove-btn {
      color: var(--danger);
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .payment-cart .remove-btn:hover {
      color: #e53e3e;
      transform: scale(1.1);
    }

    .payment-totals {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .payment-total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .payment-total-row:last-child {
      margin-bottom: 0;
    }

    .payment-total-label {
      font-weight: 500;
    }

    .payment-total-value {
      font-weight: 600;
    }

    .payment-grand-total {
      font-size: 1.2rem;
      color: var(--success);
    }

    .payment-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .payment-method-btn {
      background: #edf2f7;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .payment-method-btn.active {
      background: var(--primary);
      color: white;
    }

    .payment-method-btn:hover {
      background: #e2e8f0;
    }

    .payment-method-btn.active:hover {
      background: var(--secondary);
    }

    .payment-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    /* Sales Modal */
    .sales-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 40;
      justify-content: center;
      align-items: center;
    }

    .sales-modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 2rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .sales-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #edf2f7;
    }

    .sales-modal-header h2 {
      margin: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .sales-modal-header h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .sales-modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #718096;
      transition: color 0.2s;
    }

    .sales-modal-close:hover {
      color: var(--danger);
    }

    /* Users Management Modal */
    .users-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 40;
      justify-content: center;
      align-items: center;
    }

    .users-modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 2rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }

    .users-list {
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .user-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      border-bottom: 1px solid #edf2f7;
    }

    .user-item:last-child {
      border-bottom: none;
    }

    .user-actions button {
      margin-left: 0.5rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }

    /* Username Dropdown */
    .username-dropdown {
      position: relative;
      margin-bottom: 1rem;
    }

    .username-dropdown select {
      width: 100%;
      padding: 0.875rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      background-color: white;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.875rem center;
      background-size: 1rem;
    }

    .username-dropdown select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }

    /* Change Password Modal */
    .change-password-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 40;
      justify-content: center;
      align-items: center;
    }

    .change-password-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      padding: 2rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }

    .change-password-content h2 {
      margin-top: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .change-password-content h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .password-error {
      color: var(--danger);
      background: rgba(245, 101, 101, 0.1);
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      display: none;
    }

    /* Receipt Modal */
    .receipt-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 50;
      justify-content: center;
      align-items: center;
    }

    .receipt-content {
      background: white;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }

    .receipt-header {
      text-align: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px dashed #cbd5e0;
    }

    .receipt-header h2 {
      margin: 0 0 0.5rem 0;
      color: var(--dark);
    }

    .receipt-header p {
      margin: 0;
      color: #718096;
      font-size: 0.9rem;
    }

    .receipt-items {
      margin-bottom: 1rem;
    }

    .receipt-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .receipt-item-name {
      flex: 2;
    }

    .receipt-item-qty {
      flex: 1;
      text-align: center;
    }

    .receipt-item-price {
      flex: 1;
      text-align: right;
    }

    .receipt-totals {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed #cbd5e0;
    }

    .receipt-total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .receipt-grand-total {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--success);
    }

    .receipt-footer {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px dashed #cbd5e0;
      color: #718096;
      font-size: 0.8rem;
    }

    .shift-status {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .shift-open {
      background-color: var(--success);
      color: white;
    }
    
    .shift-closed {
      background-color: var(--danger);
      color: white;
    }

    /* Print styles for receipt */
    @media print {
      body * {
        visibility: hidden;
      }
      .receipt-modal,
      .receipt-modal * {
        visibility: visible;
      }
      .receipt-modal {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: auto;
        margin: 0;
        padding: 0;
        box-shadow: none;
      }
      .receipt-content {
        box-shadow: none;
        border: none;
        width: 100%;
        max-width: 100%;
        padding: 1rem;
      }
      .receipt-actions {
        display: none;
      }
    }

    /* Return Modal */
    .return-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 50;
      justify-content: center;
      align-items: center;
    }

    .return-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      padding: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }

    .return-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #edf2f7;
    }

    .return-header h2 {
      margin: 0;
      color: var(--dark);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .return-header h2 i {
      margin-right: 10px;
      color: var(--primary);
    }

    .return-product-info {
      margin-bottom: 1.5rem;
    }

    .return-product-name {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .return-product-details {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      color: #718096;
    }

    .return-form-group {
      margin-bottom: 1rem;
    }

    .return-form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .return-reasons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .return-reason-btn {
      background: #edf2f7;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .return-reason-btn.active {
      background: var(--primary);
      color: white;
    }

    .return-reason-btn:hover {
      background: #e2e8f0;
    }

    .return-reason-btn.active:hover {
      background: var(--secondary);
    }

    .return-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    /* Activity Log */
    .activity-log-toggle {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 50px;
      height: 50px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 10;
      transition: all 0.3s ease;
    }

    .activity-log-toggle:hover {
      background: var(--secondary);
      transform: scale(1.1);
    }

    .activity-log-toggle i {
      font-size: 1.5rem;
    }

    /* Notification badge for activity log */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      background-color: var(--danger);
      color: white;
      border-radius: 50%;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .activity-log {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 300px;
      max-height: 400px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      z-index: 10;
      transform: translateY(100%);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .activity-log.active {
      transform: translateY(0);
      opacity: 1;
    }

    .activity-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--primary);
      color: white;
    }

    .activity-header h3 {
      margin: 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
    }

    .activity-header h3 i {
      margin-right: 8px;
      color: var(--gold);
    }

    .activity-close {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .activity-content {
      max-height: 350px;
      overflow-y: auto;
      padding: 1rem;
    }

    .activity-item {
      font-size: 0.85rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid #f0f4f8;
      display: flex;
      align-items: center;
    }

    .activity-item i {
      margin-right: 8px;
      color: var(--accent);
      font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .payment-grid {
        grid-template-columns: 1fr;
      }
      
      .stock-table th, 
      .stock-table td {
        padding: 0.75rem;
      }
    }

    @media (max-width: 768px) {
      body {
        grid-template-columns: 1fr;
        grid-template-areas:
          "header"
          "content";
      }
      
      .sidebar {
        display: none;
      }
      
      .sidebar.active {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100%;
        z-index: 100;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      }
      
      .login-container {
        width: 90%;
        margin: 2rem auto;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .date-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .payment-products-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      .return-reasons {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .header {
        padding-left: 4rem;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .back-button {
        top: 1rem;
        left: 0.5rem;
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
      }
      
      .stock-form {
        padding: 1.5rem 1rem;
      }
      
      .form-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .activity-log {
        width: calc(100% - 2rem);
        max-height: 60vh;
      }
      
      .payment-methods {
        grid-template-columns: 1fr;
      }

      .payment-actions {
        grid-template-columns: 1fr;
      }

      .return-actions {
        flex-direction: column;
      }
      
      .payment-product-card {
        padding: 0.75rem;
      }
      
      .payment-product-card h3 {
        font-size: 0.8rem;
      }
      
      .payment-product-card .product-size {
        font-size: 0.7rem;
      }
      
      .payment-product-card .product-price {
        font-size: 0.8rem;
      }
    }
  </style>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <div class="header">
    <button id="backButton" class="back-button">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <h1><i class="fas fa-wine-bottle"></i> Afya Center Stock Management</h1>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <ul class="sidebar-menu">
      <li onclick="showStockTaking()">
        <i class="fas fa-clipboard-list"></i> Daily Stock Entry
      </li>
      <li onclick="showPaymentSystem()">
        <i class="fas fa-cash-register"></i> POS System
      </li>
      <li onclick="showInventory()">
        <i class="fas fa-warehouse"></i> Inventories
      </li>
      <li onclick="showDailySales()">
        <i class="fas fa-chart-bar"></i> Sales Reports
      </li>
      <li id="usersSidebarButton" onclick="showUsersManagement()" style="display: none;">
        <i class="fas fa-users"></i> Users
      </li>
    </ul>
  </div>

  <!-- Content Area -->
  <div class="content-area">
    <!-- Login Container -->
    <div class="login-container">
      <h2><i class="fas fa-sign-in-alt"></i> System Login</h2>
      <div class="error" id="errorMsg"></div>
      <div class="username-dropdown">
        <select id="usernameDropdown">
          <option value="">Select a user</option>
          <!-- Users will be populated here -->
        </select>
      </div>
      <input type="text" id="username" placeholder="Username" style="display: none;">
      <input type="password" id="password" placeholder="Password">
      <button id="loginButton" class="btn btn-primary">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
    </div>

    <!-- User Info -->
    <div id="userInfo" class="user-info">
      <i class="fas fa-user"></i>
      <span id="usernameDisplay"></span>
    </div>

    <!-- Stock Form -->
    <div class="stock-form-container" id="stockForm">
      <div class="stock-form">
        <div class="form-header">
          <h2><i class="fas fa-clipboard-list"></i> Daily Stock Entry</h2>
          <div class="date-controls">
            <input type="date" id="reportDate">
            <button onclick="saveSlip()" class="btn btn-success">
              <i class="fas fa-save"></i> Save
            </button>
            <button onclick="createNewSlip()" class="btn btn-gold">
              <i class="fas fa-plus-circle"></i> New Slip
            </button>
          </div>
        </div>

        <div class="add-item-form" id="addItemForm">
          <h3><i class="fas fa-plus-circle"></i> Add New Product</h3>
          <div class="form-row">
            <input type="text" id="newProductName" placeholder="Product Name">
            <input type="text" id="newProductSize" placeholder="Size (optional)">
          </div>
          <div class="form-row">
            <input type="number" id="newProductCost" placeholder="Cost Price">
            <input type="number" id="newProductSelling" placeholder="Selling Price">
          </div>
          <button onclick="addNewProduct()" class="btn btn-success">
            <i class="fas fa-plus"></i> Add Product
          </button>
        </div>

        <!-- Beers Section -->
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('beers')">
            <i class="fas fa-beer"></i> Beers
          </div>
          <div class="category-content" id="beersContent">
            <div class="table-container">
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Action</th>
                    <th><i class="fas fa-beer"></i> Product</th>
                    <th><i class="fas fa-ruler"></i> Size</th>
                    <th><i class="fas fa-tag"></i> Cost</th>
                    <th><i class="fas fa-tags"></i> Selling</th>
                    <th><i class="fas fa-box-open"></i> Opening</th>
                    <th><i class="fas fa-plus-circle"></i> Added</th>
                    <th><i class="fas fa-calculator"></i> Total</th>
                    <th><i class="fas fa-shopping-cart"></i> Sold</th>
                    <th><i class="fas fa-box"></i> Closing</th>
                    <th><i class="fas fa-money-bill-wave"></i> Sales</th>
                    <th><i class="fas fa-coins"></i> Profit</th>
                  </tr>
                </thead>
                <tbody id="beersTableBody"></tbody>
              </table>
            </div>
            <button onclick="addRow('beers')" class="btn btn-accent" style="margin-top: 1rem;">
              <i class="fas fa-plus"></i> Add Beer
            </button>
          </div>
        </div>

        <!-- Wines Section -->
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('wines')">
            <i class="fas fa-wine-bottle"></i> Wines
          </div>
          <div class="category-content" id="winesContent">
            <div class="table-container">
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Action</th>
                    <th><i class="fas fa-wine-bottle"></i> Product</th>
                    <th><i class="fas fa-ruler"></i> Size</th>
                    <th><i class="fas fa-tag"></i> Cost</th>
                    <th><i class="fas fa-tags"></i> Selling</th>
                    <th><i class="fas fa-box-open"></i> Opening</th>
                    <th><i class="fas fa-plus-circle"></i> Added</th>
                    <th><i class="fas fa-calculator"></i> Total</th>
                    <th><i class="fas fa-shopping-cart"></i> Sold</th>
                    <th><i class="fas fa-box"></i> Closing</th>
                    <th><i class="fas fa-money-bill-wave"></i> Sales</th>
                    <th><i class="fas fa-coins"></i> Profit</th>
                  </tr>
                </thead>
                <tbody id="winesTableBody"></tbody>
              </table>
            </div>
            <button onclick="addRow('wines')" class="btn btn-accent" style="margin-top: 1rem;">
              <i class="fas fa-plus"></i> Add Wine
            </button>
          </div>
        </div>

        <!-- Spirits Section -->
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('spirits')">
            <i class="fas fa-glass-whiskey"></i> Spirits
          </div>
          <div class="category-content" id="spiritsContent">
            <div class="table-container">
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Action</th>
                    <th><i class="fas fa-wine-bottle"></i> Product</th>
                    <th><i class="fas fa-ruler"></i> Size</th>
                    <th><i class="fas fa-tag"></i> Cost</th>
                    <th><i class="fas fa-tags"></i> Selling</th>
                    <th><i class="fas fa-box-open"></i> Opening</th>
                    <th><i class="fas fa-plus-circle"></i> Added</th>
                    <th><i class="fas fa-calculator"></i> Total</th>
                    <th><i class="fas fa-shopping-cart"></i> Sold</th>
                    <th><i class="fas fa-box"></i> Closing</th>
                    <th><i class="fas fa-money-bill-wave"></i> Sales</th>
                    <th><i class="fas fa-coins"></i> Profit</th>
                  </tr>
                </thead>
                <tbody id="spiritsTableBody"></tbody>
              </table>
            </div>
            <button onclick="addRow('spirits')" class="btn btn-accent" style="margin-top: 1rem;">
              <i class="fas fa-plus"></i> Add Spirit
            </button>
          </div>
        </div>

        <!-- Soft Drinks Section -->
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('softDrinks')">
            <i class="fas fa-glass-cheers"></i> Soft Drinks
          </div>
          <div class="category-content" id="softDrinksContent">
            <div class="table-container">
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Action</th>
                    <th><i class="fas fa-wine-bottle"></i> Product</th>
                    <th><i class="fas fa-ruler"></i> Size</th>
                    <th><i class="fas fa-tag"></i> Cost</th>
                    <th><i class="fas fa-tags"></i> Selling</th>
                    <th><i class="fas fa-box-open"></i> Opening</th>
                    <th><i class="fas fa-plus-circle"></i> Added</th>
                    <th><i class="fas fa-calculator"></i> Total</th>
                    <th><i class="fas fa-shopping-cart"></i> Sold</th>
                    <th><i class="fas fa-box"></i> Closing</th>
                    <th><i class="fas fa-money-bill-wave"></i> Sales</th>
                    <th><i class="fas fa-coins"></i> Profit</th>
                  </tr>
                </thead>
                <tbody id="softDrinksTableBody"></tbody>
              </table>
            </div>
            <button onclick="addRow('softDrinks')" class="btn btn-accent" style="margin-top: 1rem;">
              <i class="fas fa-plus"></i> Add Soft Drink
            </button>
          </div>
        </div>

        <!-- Others Section -->
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('others')">
            <i class="fas fa-ellipsis-h"></i> Others
          </div>
          <div class="category-content" id="othersContent">
            <div class="table-container">
              <table class="stock-table">
                <thead>
                  <tr>
                    <th>Action</th>
                    <th><i class="fas fa-wine-bottle"></i> Product</th>
                    <th><i class="fas fa-ruler"></i> Size</th>
                    <th><i class="fas fa-tag"></i> Cost</th>
                    <th><i class="fas fa-tags"></i> Selling</th>
                    <th><i class="fas fa-box-open"></i> Opening</th>
                    <th><i class="fas fa-plus-circle"></i> Added</th>
                    <th><i class="fas fa-calculator"></i> Total</th>
                    <th><i class="fas fa-shopping-cart"></i> Sold</th>
                    <th><i class="fas fa-box"></i> Closing</th>
                    <th><i class="fas fa-money-bill-wave"></i> Sales</th>
                    <th><i class="fas fa-coins"></i> Profit</th>
                  </tr>
                </thead>
                <tbody id="othersTableBody"></tbody>
              </table>
            </div>
            <button onclick="addRow('others')" class="btn btn-accent" style="margin-top: 1rem;">
              <i class="fas fa-plus"></i> Add Other Item
            </button>
          </div>
        </div>

        <div class="form-actions">
          <button onclick="exportCSV()" class="btn btn-warning">
            <i class="fas fa-file-export"></i> Export CSV
          </button>
        </div>
      </div>
    </div>

    <!-- Inventory Section -->
    <div class="inventory-container" id="inventoryContainer">
      <div class="stock-form">
        <div class="form-header">
          <h2><i class="fas fa-warehouse"></i> Inventory Management</h2>
          <button onclick="addInventoryItem()" class="btn btn-success">
            <i class="fas fa-plus"></i> Add Item
          </button>
        </div>

        <div class="table-container">
          <table class="stock-table inventory-table">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Size</th>
                <th>Price (Ksh)</th>
                <th>Current Stock</th>
                <th>Min Stock Level</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="inventoryTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Payment System Section -->
    <div class="payment-container" id="paymentContainer">
      <div class="payment-grid">
        <!-- Products Section -->
        <div class="payment-products-container">
          <div class="payment-header">
            <h2><i class="fas fa-shopping-basket"></i> Products</h2>
          </div>

          <div class="product-categories" id="productCategories">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="beers">Beers</button>
            <button class="category-btn" data-category="wines">Wines</button>
            <button class="category-btn" data-category="spirits">Spirits</button>
            <button class="category-btn" data-category="softDrinks">Soft Drinks</button>
            <button class="category-btn" data-category="others">Others</button>
          </div>

          <div class="payment-products-grid" id="paymentProductsGrid">
            <!-- Products will be loaded here -->
          </div>
        </div>

        <!-- Cart Section -->
        <div class="payment-cart-container">
          <div class="payment-header">
            <h2><i class="fas fa-shopping-cart"></i> Cart</h2>
          </div>

          <div class="payment-cart">
            <table id="paymentCartTable">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Price</th>
                  <th>Qty</th>
                  <th>Total</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="paymentCartBody"></tbody>
            </table>
          </div>

          <div class="payment-totals">
            <div class="payment-total-row">
              <span class="payment-total-label">Subtotal:</span>
              <span class="payment-total-value" id="paymentSubtotal">0.00 Ksh</span>
            </div>
            <div class="payment-total-row">
              <span class="payment-total-label">Tax (0%):</span>
              <span class="payment-total-value" id="paymentTax">0.00 Ksh</span>
            </div>
            <div class="payment-total-row payment-grand-total">
              <span class="payment-total-label">Total:</span>
              <span class="payment-total-value" id="paymentTotal">0.00 Ksh</span>
            </div>
          </div>

          <div class="payment-methods">
            <button class="payment-method-btn active" data-method="cash">
              <i class="fas fa-money-bill-wave"></i> Cash
            </button>
            <button class="payment-method-btn" data-method="mpesa">
              <i class="fas fa-mobile-alt"></i> M-Pesa
            </button>
          </div>

          <div class="payment-actions">
            <button onclick="clearCart()" class="btn btn-danger">
              <i class="fas fa-trash"></i> Clear
            </button>
            <button onclick="processPayment()" class="btn btn-success">
              <i class="fas fa-check"></i> Complete Sale
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payments Full Screen View -->
  <div id="paymentsFullScreen" class="full-screen-content">
    <div class="full-screen-header">
      <h2><i class="fas fa-money-bill-wave"></i> PAYMENTS</h2>
      <button onclick="exitFullScreen()" class="btn btn-primary">
        <i class="fas fa-times"></i> Exit Full Screen
      </button>
    </div>
    <!-- Payment interface content will go here -->
    <div id="paymentInterfaceContent">
      <!-- Payment interface will be loaded here when Payments is clicked -->
    </div>
  </div>

  <!-- Sales Modal -->
  <div id="salesModal" class="sales-modal">
    <div class="sales-modal-content">
      <div class="sales-modal-header">
        <h2><i class="fas fa-chart-bar"></i> Daily Sales Report</h2>
        <button class="sales-modal-close" onclick="closeSalesModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <p id="salesReportDate" style="font-weight: 500; color: var(--dark);"></p>
      <div class="table-container">
        <table class="stock-table">
          <thead>
            <tr>
              <th><i class="fas fa-wine-bottle"></i> Product</th>
              <th><i class="fas fa-ruler"></i> Size</th>
              <th><i class="fas fa-shopping-cart"></i> Qty Sold</th>
              <th><i class="fas fa-tags"></i> Unit Price</th>
              <th><i class="fas fa-money-bill-wave"></i> Total Sales</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="salesTableBody"></tbody>
        </table>
      </div>
      <div style="text-align: right; margin-top: 1.5rem; font-weight: 600; font-size: 1.1rem;">
        Grand Total: <span id="grandTotal" style="color: var(--success);">0.00</span> Ksh
      </div>
    </div>
  </div>

  <!-- Users Management Modal -->
  <div id="usersModal" class="users-modal">
    <div class="users-modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-users"></i> Users Management</h2>
        <button class="modal-close" onclick="closeUsersModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="form-row">
        <input type="text" id="newUsername" placeholder="New Username">
        <button onclick="addUser()" class="btn btn-success">
          <i class="fas fa-plus"></i> Add User
        </button>
      </div>
      <div class="users-list" id="usersList">
        <!-- Users will be listed here -->
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="changePasswordModal" class="change-password-modal">
    <div class="change-password-content">
      <h2><i class="fas fa-key"></i> Change Password</h2>
      <div class="password-error" id="passwordError"></div>
      <input type="password" id="currentPassword" placeholder="Current Password">
      <input type="password" id="newPassword" placeholder="New Password">
      <input type="password" id="confirmPassword" placeholder="Confirm New Password">
      <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
        <button onclick="changePassword()" class="btn btn-primary" style="flex: 1;">
          <i class="fas fa-save"></i> Change Password
        </button>
        <button onclick="closeChangePasswordModal()" class="btn btn-danger" style="flex: 1;">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Receipt Modal -->
  <div id="receiptModal" class="receipt-modal">
    <div class="receipt-content">
      <div class="receipt-header">
        <h2>Afya Center</h2>
        <p>Stock Management System</p>
        <p id="receiptDate"></p>
        <p id="receiptNumber"></p>
      </div>
      
      <div class="receipt-items" id="receiptItems">
        <!-- Items will be added here -->
      </div>
      
      <div class="receipt-totals">
        <div class="receipt-total-row">
          <span>Subtotal:</span>
          <span id="receiptSubtotal">0.00 Ksh</span>
        </div>
        <div class="receipt-total-row">
          <span>Tax (0%):</span>
          <span id="receiptTax">0.00 Ksh</span>
        </div>
        <div class="receipt-total-row receipt-grand-total">
          <span>Total:</span>
          <span id="receiptTotal">0.00 Ksh</span>
        </div>
        <div class="receipt-total-row">
          <span>Payment Method:</span>
          <span id="receiptPaymentMethod">Cash</span>
        </div>
      </div>
      
      <div class="receipt-footer">
        <p>Thank you for your purchase!</p>
        <p>Generated by: <span id="receiptCashier"></span></p>
        <p>Shift Status: <span id="shiftStatus" class="shift-status shift-open">OPEN</span></p>
      </div>
      
      <div style="margin-top: 1.5rem; display: flex; justify-content: center;">
        <button onclick="printReceipt()" class="btn btn-primary">
          <i class="fas fa-print"></i> Print Receipt
        </button>
      </div>
    </div>
  </div>

  <!-- Return Modal -->
  <div id="returnModal" class="return-modal">
    <div class="return-content">
      <div class="return-header">
        <h2><i class="fas fa-undo"></i> Return Product</h2>
        <button class="modal-close" onclick="closeReturnModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="return-product-info">
        <div class="return-product-name" id="returnProductName"></div>
        <div class="return-product-details">
          <span id="returnProductSize"></span>
          <span id="returnProductPrice"></span>
          <span>Qty: <span id="returnProductQty"></span></span>
        </div>
      </div>
      
      <div class="return-form-group">
        <label>Return Quantity:</label>
        <input type="number" id="returnQty" min="1" value="1" class="form-control">
      </div>
      
      <div class="return-form-group">
        <label>Select Reason:</label>
        <div class="return-reasons">
          <button class="return-reason-btn" data-reason="damaged">Damaged</button>
          <button class="return-reason-btn" data-reason="wrong-item">Wrong Item</button>
          <button class="return-reason-btn" data-reason="expired">Expired</button>
          <button class="return-reason-btn" data-reason="customer-change">Customer Changed Mind</button>
        </div>
        <textarea id="returnNotes" placeholder="Additional notes (optional)" rows="2" style="margin-top: 0.5rem;"></textarea>
      </div>
      
      <div class="return-actions">
        <button onclick="closeReturnModal()" class="btn btn-danger" style="flex: 1;">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button onclick="processReturn()" class="btn btn-success" style="flex: 1;">
          <i class="fas fa-check"></i> Process Return
        </button>
      </div>
    </div>
  </div>

  <!-- Activity Log Toggle Button -->
  <div class="activity-log-toggle" onclick="toggleActivityLog()">
    <i class="fas fa-comment-alt"></i>
  </div>

  <!-- Activity Log -->
  <div class="activity-log" id="activityLog">
    <div class="activity-header">
      <h3><i class="fas fa-history"></i> Activity Log</h3>
      <button class="activity-close" onclick="toggleActivityLog()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="activity-content" id="activityLogContent"></div>
  </div>

  <script>
    // Global variables
    let savedSlips = JSON.parse(localStorage.getItem("savedSlips")) || {};
    let products = JSON.parse(localStorage.getItem("products")) || [];
    let adminProducts = JSON.parse(localStorage.getItem("adminProducts")) || [];
    let currentReturnItem = null;
    let currentUser = null;
    let currentView = null; // Track current view for back button
    let users = JSON.parse(localStorage.getItem("users")) || [
      { username: "admin", password: "password", isAdmin: true, hasChangedPassword: false },
      { username: "employee", password: "password", isAdmin: false, hasChangedPassword: false }
    ];
    let shiftOpen = true;
    
    // Payment system variables
    let cart = [];
    let paymentProducts = [];
    let selectedPaymentMethod = "cash";
    let selectedCategory = "all";

    // Function to determine product category
    function determineCategory(productName) {
      const name = productName.toLowerCase();
      
      // Beers
      if (name.includes('beer') || 
          name.includes('lager') || 
          name.includes('ale') || 
          name.includes('stout') || 
          name.includes('tusker') || 
          name.includes('pilsner') || 
          name.includes('heineken') || 
          name.includes('guinness') || 
          name.includes('white cap') || 
          name.includes('safari') || 
          name.includes('balozi') || 
          name.includes('senator') || 
          name.includes('barrel')) {
        return 'beers';
      }
      
      // Wines
      if (name.includes('wine') || 
          name.includes('champagne') || 
          name.includes('sparkling') ||
          name.includes('red') || 
          name.includes('white') || 
          name.includes('rose') || 
          name.includes('four cousins') || 
          name.includes('drostdy') || 
          name.includes('robertson') || 
          name.includes('nederburg') || 
          name.includes('jacob\'s creek') || 
          name.includes('bellingham')) {
        return 'wines';
      }
      
      // Spirits
      if (name.includes('whiskey') || 
          name.includes('whisky') || 
          name.includes('vodka') || 
          name.includes('gin') || 
          name.includes('rum') || 
          name.includes('tequila') || 
          name.includes('brandy') || 
          name.includes('cognac') || 
          name.includes('baileys') || 
          name.includes('johnnie walker') || 
          name.includes('jack daniels') || 
          name.includes('jameson') || 
          name.includes('black & white') || 
          name.includes('black label') || 
          name.includes('red label') || 
          name.includes('smirnoff') || 
          name.includes('absolut') || 
          name.includes('tanqueray') || 
          name.includes('bombay sapphire') || 
          name.includes('captain morgan') || 
          name.includes('jose cuervo') ||
          name.includes('chrome') ||
          name.includes('chrom')) {
        return 'spirits';
      }
      
      // Soft Drinks
      if (name.includes('soda') || 
          name.includes('juice') || 
          name.includes('water') || 
          name.includes('cola') || 
          name.includes('fanta') || 
          name.includes('sprite') || 
          name.includes('pepsi') || 
          name.includes('stoney') || 
          name.includes('krest') || 
          name.includes('malt') || 
          name.includes('mirinda') || 
          name.includes('schweppes') || 
          name.includes('minute maid') || 
          name.includes('afia')) {
        return 'softDrinks';
      }
      
      // Default to others
      return 'others';
    }

    // Update stock quantities from payment system
    function updateStockQuantities(items) {
      try {
          // Get current products
          let products = JSON.parse(localStorage.getItem("products")) || [];
          let updated = false;
          
          // Update stock for each sold item
          items.forEach(saleItem => {
              const productIndex = products.findIndex(p => 
                  p.name === saleItem.name && 
                  (p.size || '') === (saleItem.size || '')
              );
              
              if (productIndex >= 0) {
                  products[productIndex].stock = (products[productIndex].stock || 0) - saleItem.quantity;
                  updated = true;
              }
          });
          
          if (updated) {
              // Save updated products
              localStorage.setItem("products", JSON.stringify(products));
              
              // Update the inventory view if open
              if (document.getElementById("inventoryContainer").style.display === "block") {
                  loadInventory();
              }
              
              // Update the stock taking view if open
              if (document.getElementById("stockForm").style.display === "block") {
                  loadSlip(document.getElementById("reportDate").value);
              }
              
              logActivity(`Stock updated for ${items.length} products from payment system`);
              return true;
          }
          return false;
      } catch (e) {
          console.error("Error updating stock:", e);
          logActivity(`Failed to update stock: ${e.message}`);
          return false;
      }
    }

    // Show payment system
    function showPaymentSystem() {
      // Hide all other content
      document.querySelectorAll('.content-area > div').forEach(div => {
        div.style.display = 'none';
      });
      
      // Show payment system
      document.getElementById("paymentContainer").style.display = "block";
      currentView = 'paymentSystem';
      showBackButton();
      
      // Load products for payment system
      loadPaymentProducts();
      updateCartDisplay();
      
      logActivity("Opened payment system");
    }

    // Show payments in full screen
    function showPaymentsFullScreen() {
      document.getElementById('paymentsFullScreen').style.display = 'block';
      document.body.style.overflow = 'hidden';
      
      // Load payment interface content
      document.getElementById('paymentInterfaceContent').innerHTML = `
        <div style="text-align: center; margin-top: 2rem;">
          <h3>Payment Processing Interface</h3>
          <p>This is where the payment processing would happen in full screen mode.</p>
          <div style="margin-top: 2rem;">
            <button class="btn btn-success" style="padding: 1rem 2rem; font-size: 1.2rem;">
              <i class="fas fa-check-circle"></i> Process Payment
            </button>
          </div>
        </div>
      `;
    }

    // Exit full screen view
    function exitFullScreen() {
      document.getElementById('paymentsFullScreen').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // Hide payment system
    function hidePaymentSystem() {
      document.getElementById("paymentContainer").style.display = "none";
      hideBackButton();
    }

    // Load products for payment system
    function loadPaymentProducts() {
      const productsGrid = document.getElementById("paymentProductsGrid");
      productsGrid.innerHTML = '';
      
      paymentProducts = products.filter(p => p.price > 0);
      
      paymentProducts.forEach((product, index) => {
        const category = product.category || determineCategory(product.name);
        
        // Skip if not in selected category
        if (selectedCategory !== "all" && category !== selectedCategory) return;
        
        const productElement = document.createElement("div");
        productElement.className = "payment-product-card";
        productElement.dataset.category = category;
        productElement.innerHTML = `
          <img src="https://via.placeholder.com/60?text=${product.name.substring(0,2)}" alt="${product.name}">
          <h3>${product.name}</h3>
          ${product.size ? `<div class="product-size">${product.size}</div>` : ''}
          <div class="product-price">${product.price.toFixed(2)} Ksh</div>
        `;
        productElement.onclick = () => addToCart(product);
        productsGrid.appendChild(productElement);
      });
      
      // Set up category buttons
      const categoryButtons = document.querySelectorAll('.category-btn');
      categoryButtons.forEach(button => {
        button.addEventListener('click', () => {
          categoryButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          selectedCategory = button.dataset.category;
          loadPaymentProducts();
        });
      });
      
      // Set up payment method buttons
      const paymentMethodButtons = document.querySelectorAll('.payment-method-btn');
      paymentMethodButtons.forEach(button => {
        button.addEventListener('click', () => {
          paymentMethodButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          selectedPaymentMethod = button.dataset.method;
        });
      });
    }

    // Add product to cart
    function addToCart(product) {
      const existingItem = cart.find(item => 
        item.name === product.name && 
        (item.size || '') === (product.size || '')
      );
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          name: product.name,
          size: product.size || '',
          price: product.price,
          quantity: 1
        });
      }
      
      updateCartDisplay();
      
      // Animate the product card
      const productCards = document.querySelectorAll('.payment-product-card');
      productCards.forEach(card => {
        if (card.querySelector('h3').textContent === product.name && 
            card.querySelector('.product-size')?.textContent === (product.size || '')) {
          card.classList.add('selected');
          setTimeout(() => card.classList.remove('selected'), 300);
        }
      });
    }

    // Update cart display
    function updateCartDisplay() {
      const cartBody = document.getElementById("paymentCartBody");
      cartBody.innerHTML = '';
      
      let subtotal = 0;
      
      cart.forEach((item, index) => {
        const row = document.createElement("tr");
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        
        row.innerHTML = `
          <td>${item.name} ${item.size ? '(' + item.size + ')' : ''}</td>
          <td>${item.price.toFixed(2)}</td>
          <td>
            <div class="quantity-control">
              <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">-</button>
              ${item.quantity}
              <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
            </div>
          </td>
          <td>${itemTotal.toFixed(2)}</td>
          <td>
            <button class="remove-btn" onclick="removeFromCart(${index})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        cartBody.appendChild(row);
      });
      
      const tax = 0; // You can add tax calculation here if needed
      const total = subtotal + tax;
      
      document.getElementById("paymentSubtotal").textContent = subtotal.toFixed(2) + " Ksh";
      document.getElementById("paymentTax").textContent = tax.toFixed(2) + " Ksh";
      document.getElementById("paymentTotal").textContent = total.toFixed(2) + " Ksh";
    }

    // Change quantity of item in cart
    function changeQuantity(index, change) {
      const newQuantity = cart[index].quantity + change;
      
      if (newQuantity > 0) {
        cart[index].quantity = newQuantity;
      } else {
        cart.splice(index, 1);
      }
      
      updateCartDisplay();
    }

    // Remove item from cart
    function removeFromCart(index) {
      cart.splice(index, 1);
      updateCartDisplay();
    }

    // Clear cart
    function clearCart() {
      if (cart.length === 0) return;
      
      if (confirm("Are you sure you want to clear the cart?")) {
        cart = [];
        updateCartDisplay();
        logActivity("Cleared payment cart");
      }
    }

    // Process payment
    function processPayment() {
      if (cart.length === 0) {
        alert("Cart is empty. Please add items before completing sale.");
        return;
      }
      
      // Update stock quantities
      const stockUpdated = updateStockQuantities(cart);
      
      if (!stockUpdated) {
        alert("Failed to update stock quantities. Please try again.");
        return;
      }
      
      // Record the sale
      const today = new Date().toISOString().split('T')[0];
      const sales = JSON.parse(localStorage.getItem("sales")) || {};
      
      if (!sales[today]) {
        sales[today] = [];
      }
      
      cart.forEach(item => {
        sales[today].push({
          name: item.name,
          size: item.size,
          quantity: item.quantity,
          price: item.price,
          total: item.price * item.quantity,
          timestamp: new Date().toISOString(),
          paymentMethod: selectedPaymentMethod
        });
      });
      
      localStorage.setItem("sales", JSON.stringify(sales));
      
      // Calculate total
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const tax = 0; // You can add tax calculation here if needed
      const total = subtotal + tax;
      
      // Generate receipt
      generateReceipt();
      
      // Clear cart
      cart = [];
      updateCartDisplay();
      
      logActivity(`Completed ${selectedPaymentMethod} sale for ${total.toFixed(2)} Ksh`);
    }

    // Generate receipt
    function generateReceipt() {
      const receiptItems = document.getElementById("receiptItems");
      receiptItems.innerHTML = '';
      
      let subtotal = 0;
      
      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        
        const itemElement = document.createElement("div");
        itemElement.className = "receipt-item";
        itemElement.innerHTML = `
          <div class="receipt-item-name">${item.name} ${item.size ? '(' + item.size + ')' : ''}</div>
          <div class="receipt-item-qty">${item.quantity}</div>
          <div class="receipt-item-price">${itemTotal.toFixed(2)}</div>
        `;
        receiptItems.appendChild(itemElement);
      });
      
      const tax = 0; // You can add tax calculation here if needed
      const total = subtotal + tax;
      
      // Set receipt details
      const now = new Date();
      document.getElementById("receiptDate").textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
      document.getElementById("receiptNumber").textContent = 'Receipt #' + Math.floor(Math.random() * 1000000);
      document.getElementById("receiptSubtotal").textContent = subtotal.toFixed(2) + ' Ksh';
      document.getElementById("receiptTax").textContent = tax.toFixed(2) + ' Ksh';
      document.getElementById("receiptTotal").textContent = total.toFixed(2) + ' Ksh';
      document.getElementById("receiptPaymentMethod").textContent = selectedPaymentMethod === 'cash' ? 'Cash' : 'M-Pesa';
      document.getElementById("receiptCashier").textContent = currentUser.username;
      document.getElementById("shiftStatus").textContent = shiftOpen ? "OPEN" : "CLOSED";
      document.getElementById("shiftStatus").className = shiftOpen ? "shift-status shift-open" : "shift-status shift-closed";
      
      // Show receipt modal
      document.getElementById("receiptModal").style.display = "flex";
    }

    // Print receipt
    function printReceipt() {
      window.print();
    }

    // Close receipt modal
    function closeReceiptModal() {
      document.getElementById("receiptModal").style.display = "none";
    }

    // Initialize the system
    function initializeSystem() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('reportDate').value = today;
      
      // Initialize products if empty
      if (products.length === 0) {
        products = [
          {id: "tusker-bottle", name: "Tusker", size: "Bottle", price: 250, stock: 10, minStock: 5, category: "beers"},
          {id: "tusker-can", name: "Tusker", size: "Can", price: 180, stock: 15, minStock: 10, category: "beers"},
          {id: "white-cap", name: "White Cap", size: "Bottle", price: 230, stock: 8, minStock: 5, category: "beers"},
          {id: "four-cousins", name: "Four Cousins", size: "750ml", price: 1200, stock: 5, minStock: 3, category: "wines"},
          {id: "drostdy", name: "Drostdy", size: "750ml", price: 950, stock: 4, minStock: 2, category: "wines"},
          {id: "smirnoff", name: "Smirnoff", size: "750ml", price: 1800, stock: 6, minStock: 3, category: "spirits"},
          {id: "coca-cola", name: "Coca Cola", size: "500ml", price: 80, stock: 20, minStock: 10, category: "softDrinks"},
          {id: "fanta", name: "Fanta", size: "500ml", price: 80, stock: 18, minStock: 10, category: "softDrinks"},
          {id: "water", name: "Bottled Water", size: "500ml", price: 50, stock: 30, minStock: 15, category: "softDrinks"}
        ];
        localStorage.setItem("products", JSON.stringify(products));
      }
      
      // Save users if not already saved
      if (!localStorage.getItem("users")) {
        localStorage.setItem("users", JSON.stringify(users));
      }
      
      // Set up back button event listener
      document.getElementById('backButton').addEventListener('click', goBack);
      
      // Set up activity log toggle
      document.querySelector('.activity-log-toggle').addEventListener('click', toggleActivityLog);
      document.querySelector('.activity-close').addEventListener('click', toggleActivityLog);
      
      // Set up username dropdown
      updateUsernameDropdown();
      
      // Set up username dropdown change event
      document.getElementById('usernameDropdown').addEventListener('change', function() {
        const selectedUsername = this.value;
        if (selectedUsername) {
          document.getElementById('username').value = selectedUsername;
        }
      });
      
      // Set up login button
      document.getElementById('loginButton').addEventListener('click', handleLogin);
      
      logActivity("System initialized");
    }

    // Handle login
    function handleLogin() {
      const username = document.getElementById("username").value || document.getElementById("usernameDropdown").value;
      const password = document.getElementById("password").value;
      
      // Find user in the users array
      const user = users.find(u => u.username === username && u.password === password);
      
      if (user) {
        currentUser = user;
        document.querySelector(".login-container").style.display = "none";
        document.getElementById("userInfo").style.display = "flex";
        document.getElementById("usernameDisplay").textContent = username;
        
        // Show add item form and users button only for admin
        if (user.isAdmin) {
          document.getElementById("addItemForm").style.display = "block";
          document.getElementById("usersSidebarButton").style.display = "block";
        } else {
          document.getElementById("addItemForm").style.display = "none";
          document.getElementById("usersSidebarButton").style.display = "none";
        }
        
        logActivity(`${username} logged in`);
        
        // Check if user needs to change password (if using default password and hasn't changed it)
        if (password === "password" && !user.hasChangedPassword) {
          showChangePasswordModal();
        } else {
          // Show default view (stock taking)
          showStockTaking();
        }
      } else {
        document.getElementById("errorMsg").textContent = "Invalid username or password";
      }
    }

    // Show change password modal
    function showChangePasswordModal() {
      const modal = document.getElementById('changePasswordModal');
      document.getElementById('passwordError').style.display = 'none';
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
      modal.style.display = 'flex';
    }

    // Close change password modal
    function closeChangePasswordModal() {
      document.getElementById('changePasswordModal').style.display = 'none';
    }

    // Change password
    function changePassword() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const errorElement = document.getElementById('passwordError');
      
      // Reset error
      errorElement.style.display = 'none';
      
      // Validate inputs
      if (!currentPassword || !newPassword || !confirmPassword) {
        errorElement.textContent = 'All fields are required';
        errorElement.style.display = 'block';
        return;
      }
      
      if (newPassword !== confirmPassword) {
        errorElement.textContent = 'New passwords do not match';
        errorElement.style.display = 'block';
        return;
      }
      
      if (newPassword === 'password') {
        errorElement.textContent = 'New password cannot be "password"';
        errorElement.style.display = 'block';
        return;
      }
      
      // Verify current password
      if (currentPassword !== currentUser.password) {
        errorElement.textContent = 'Current password is incorrect';
        errorElement.style.display = 'block';
        return;
      }
      
      // Update password
      currentUser.password = newPassword;
      currentUser.hasChangedPassword = true;
      
      // Update in users array
      const userIndex = users.findIndex(u => u.username === currentUser.username);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
        localStorage.setItem('users', JSON.stringify(users));
      }
      
      // Close modal and show default view
      closeChangePasswordModal();
      showStockTaking();
      
      logActivity(`${currentUser.username} changed their password`);
    }

    // Update username dropdown with saved users
    function updateUsernameDropdown() {
      const dropdown = document.getElementById('usernameDropdown');
      dropdown.innerHTML = '<option value="">Select a user</option>';
      
      users.forEach(user => {
        const option = document.createElement('option');
        option.value = user.username;
        option.textContent = user.username;
        dropdown.appendChild(option);
      });
    }

    // Show users management modal
    function showUsersManagement() {
      const modal = document.getElementById('usersModal');
      const usersList = document.getElementById('usersList');
      
      // Clear current list
      usersList.innerHTML = '';
      
      // Add users to the list
      users.forEach((user, index) => {
        if (user.username === 'admin') return; // Skip admin from being deleted
        
        const userItem = document.createElement('div');
        userItem.className = 'user-item';
        userItem.innerHTML = `
          <span>${user.username}</span>
          <div class="user-actions">
            <button onclick="deleteUser(${index})" class="btn btn-danger">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        `;
        usersList.appendChild(userItem);
      });
      
      modal.style.display = 'flex';
      currentView = 'usersManagement';
      showBackButton();
    }

    // Close users management modal
    function closeUsersModal() {
      document.getElementById('usersModal').style.display = 'none';
      hideBackButton();
    }

    // Add new user
    function addUser() {
      const newUsername = document.getElementById('newUsername').value.trim();
      
      if (!newUsername) {
        alert('Please enter a username');
        return;
      }
      
      // Check if user already exists
      if (users.some(user => user.username.toLowerCase() === newUsername.toLowerCase())) {
        alert('Username already exists');
        return;
      }
      
      // Add new user with default password "password" and flag to change it
      users.push({
        username: newUsername,
        password: 'password',
        isAdmin: false,
        hasChangedPassword: false
      });
      
      // Save to localStorage
      localStorage.setItem('users', JSON.stringify(users));
      
      // Update UI
      updateUsernameDropdown();
      document.getElementById('newUsername').value = '';
      
      // Add to users list in modal
      const usersList = document.getElementById('usersList');
      const userItem = document.createElement('div');
      userItem.className = 'user-item';
      userItem.innerHTML = `
        <span>${newUsername}</span>
        <div class="user-actions">
          <button onclick="deleteUser(${users.length - 1})" class="btn btn-danger">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      `;
      usersList.appendChild(userItem);
      
      logActivity(`Admin added new user: ${newUsername}`);
    }

    // Delete user
    function deleteUser(index) {
      if (index >= 0 && index < users.length) {
        const username = users[index].username;
        if (confirm(`Are you sure you want to delete user ${username}?`)) {
          users.splice(index, 1);
          localStorage.setItem('users', JSON.stringify(users));
          updateUsernameDropdown();
          
          // Refresh users list in modal
          showUsersManagement();
          
          logActivity(`Admin deleted user: ${username}`);
        }
      }
    }

    // Back button functionality
    function goBack() {
      switch(currentView) {
        case 'stockTaking':
          hideStockTaking();
          break;
        case 'salesReport':
          closeSalesModal();
          break;
        case 'inventory':
          hideInventory();
          break;
        case 'paymentSystem':
          hidePaymentSystem();
          break;
        case 'usersManagement':
          closeUsersModal();
          break;
        default:
          hideCurrentView();
      }
    }

    function hideCurrentView() {
      // Hide all main views
      document.getElementById("stockForm").style.display = "none";
      document.getElementById("inventoryContainer").style.display = "none";
      document.getElementById("paymentContainer").style.display = "none";
      document.getElementById("salesModal").style.display = "none";
      document.getElementById("usersModal").style.display = "none";
      
      // Hide back button
      document.getElementById('backButton').style.display = 'none';
      currentView = null;
    }

    function showBackButton() {
      document.getElementById('backButton').style.display = 'flex';
    }

    function hideBackButton() {
      document.getElementById('backButton').style.display = 'none';
    }

    // Toggle category section
    function toggleCategory(categoryId) {
      const content = document.getElementById(`${categoryId}Content`);
      content.style.display = content.style.display === 'none' ? 'block' : 'none';
    }

    // Toggle activity log visibility
    function toggleActivityLog() {
      const activityLog = document.getElementById('activityLog');
      activityLog.classList.toggle('active');
      
      // Clear notification badge when log is opened
      const badge = document.querySelector('.activity-log-toggle .notification-badge');
      if (badge && activityLog.classList.contains('active')) {
        badge.remove();
      }
    }

    // Show stock taking form
    function showStockTaking() {
      // Hide all other content
      document.querySelectorAll('.content-area > div').forEach(div => {
        div.style.display = 'none';
      });
      
      document.getElementById("stockForm").style.display = "block";
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("reportDate").value = today;
      loadSlip(today);
      
      // Set current view and show back button
      currentView = 'stockTaking';
      showBackButton();
      
      logActivity("Stock taking started");
      
      // Apply employee restrictions
      if (!currentUser.isAdmin) {
        const categories = ['beers', 'wines', 'spirits', 'softDrinks', 'others'];
        categories.forEach(category => {
          const rows = document.querySelectorAll(`#${category}TableBody tr`);
          rows.forEach(row => {
            ['name', 'size', 'cost', 'selling'].forEach(className => {
              const input = row.querySelector(`.${className}`);
              if (input) {
                input.readOnly = true;
                input.style.backgroundColor = "#f0f4f8";
                input.style.color = "#4a5568";
              }
            });
          });
        });
      }
    }

    function hideStockTaking() {
      document.getElementById("stockForm").style.display = "none";
      hideBackButton();
    }

    // Show inventory view
    function showInventory() {
      // Hide all other content
      document.querySelectorAll('.content-area > div').forEach(div => {
        div.style.display = 'none';
      });
      
      document.getElementById("inventoryContainer").style.display = "block";
      currentView = 'inventory';
      showBackButton();
      loadInventory();
      logActivity("Viewed inventory");
    }

    function hideInventory() {
      document.getElementById("inventoryContainer").style.display = "none";
      hideBackButton();
    }

    // Load inventory data
    function loadInventory() {
      const tbody = document.getElementById("inventoryTableBody");
      tbody.innerHTML = '';
      
      products.forEach(product => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" class="inventory-name" value="${product.name}" ${!currentUser.isAdmin ? 'readonly' : ''}></td>
          <td><input type="text" class="inventory-size" value="${product.size || ''}" ${!currentUser.isAdmin ? 'readonly' : ''}></td>
          <td><input type="number" class="inventory-price" value="${product.price}" step="0.01" ${!currentUser.isAdmin ? 'readonly' : ''}></td>
          <td><input type="number" class="inventory-stock" value="${product.stock || 0}" readonly></td>
          <td><input type="number" class="inventory-minstock" value="${product.minStock || 5}" ${!currentUser.isAdmin ? 'readonly' : ''}></td>
          <td>
            <button onclick="saveInventoryItem(this)" class="btn btn-primary" style="padding: 0.5rem; ${!currentUser.isAdmin ? 'display: none;' : ''}">
              <i class="fas fa-save"></i>
            </button>
            <button onclick="deleteInventoryItem(this)" class="btn btn-danger" style="padding: 0.5rem; ${!currentUser.isAdmin ? 'display: none;' : ''}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Add new inventory item
    function addInventoryItem() {
      const tbody = document.getElementById("inventoryTableBody");
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="inventory-name" placeholder="Product Name"></td>
        <td><input type="text" class="inventory-size" placeholder="Size (optional)"></td>
        <td><input type="number" class="inventory-price" placeholder="Price" step="0.01"></td>
        <td><input type="number" class="inventory-stock" value="0" readonly></td>
        <td><input type="number" class="inventory-minstock" value="5"></td>
        <td>
          <button onclick="saveNewInventoryItem(this)" class="btn btn-success" style="padding: 0.5rem;">
            <i class="fas fa-check"></i>
          </button>
          <button onclick="cancelNewInventoryItem(this)" class="btn btn-danger" style="padding: 0.5rem;">
            <i class="fas fa-times"></i>
          </button>
        </td>
      `;
      tbody.insertBefore(tr, tbody.firstChild);
    }

    // Save new inventory item
    function saveNewInventoryItem(button) {
      const row = button.closest('tr');
      const name = row.querySelector('.inventory-name').value.trim();
      const size = row.querySelector('.inventory-size').value.trim();
      const price = parseFloat(row.querySelector('.inventory-price').value) || 0;
      const minStock = parseInt(row.querySelector('.inventory-minstock').value) || 5;

      if (!name) {
        alert("Please enter a product name");
        return;
      }

      // Check if product already exists
      const existingIndex = products.findIndex(p => 
        p.name.toLowerCase() === name.toLowerCase() && 
        (p.size || '').toLowerCase() === (size || '').toLowerCase()
      );

      if (existingIndex >= 0) {
        alert("This product already exists in inventory");
        return;
      }

      const category = determineCategory(name);
      const newProduct = {
        id: `${name}-${size || 'standard'}`.toLowerCase().replace(/\s+/g, '-'),
        name: name,
        size: size || '',
        price: price,
        stock: 0,
        minStock: minStock,
        category: category // Store category to prevent moving between categories
      };

      products.push(newProduct);
      localStorage.setItem('products', JSON.stringify(products));
      loadInventory();
      logActivity(`Added new inventory item: ${name}${size ? ' ('+size+')' : ''}`);
    }

    // Save existing inventory item
    function saveInventoryItem(button) {
      const row = button.closest('tr');
      const name = row.querySelector('.inventory-name').value.trim();
      const size = row.querySelector('.inventory-size').value.trim();
      const price = parseFloat(row.querySelector('.inventory-price').value) || 0;
      const minStock = parseInt(row.querySelector('.inventory-minstock').value) || 5;
      const stock = parseInt(row.querySelector('.inventory-stock').value) || 0;

      if (!name) {
        alert("Please enter a product name");
        return;
      }

      // Find the product in our array
      const rowIndex = Array.from(row.parentNode.children).indexOf(row);
      if (rowIndex >= 0 && rowIndex < products.length) {
        products[rowIndex] = {
          id: products[rowIndex].id,
          name: name,
          size: size || '',
          price: price,
          stock: stock,
          minStock: minStock,
          category: products[rowIndex].category // Preserve original category
        };
        
        localStorage.setItem('products', JSON.stringify(products));
        logActivity(`Updated inventory item: ${name}${size ? ' ('+size+')' : ''}`);
      }
    }

    // Delete inventory item
    function deleteInventoryItem(button) {
      const row = button.closest('tr');
      const name = row.querySelector('.inventory-name').value;
      const size = row.querySelector('.inventory-size').value;
      
      if (confirm(`Are you sure you want to delete ${name}${size ? ' ('+size+')' : ''} from inventory?`)) {
        const rowIndex = Array.from(row.parentNode.children).indexOf(row);
        if (rowIndex >= 0 && rowIndex < products.length) {
          products.splice(rowIndex, 1);
          localStorage.setItem('products', JSON.stringify(products));
          loadInventory();
          logActivity(`Deleted inventory item: ${name}${size ? ' ('+size+')' : ''}`);
        }
      }
    }

    // Cancel new inventory item
    function cancelNewInventoryItem(button) {
      const row = button.closest('tr');
      row.remove();
    }

    // Create new slip
    function createNewSlip() {
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      
      // Calculate yesterday's date
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = yesterday.toISOString().split('T')[0];
      
      // Clear current tables
      document.getElementById('beersTableBody').innerHTML = '';
      document.getElementById('winesTableBody').innerHTML = '';
      document.getElementById('spiritsTableBody').innerHTML = '';
      document.getElementById('softDrinksTableBody').innerHTML = '';
      document.getElementById('othersTableBody').innerHTML = '';
      
      // Load yesterday's slip if it exists
      const yesterdaySlip = savedSlips[yesterdayStr] || [];
      
      if (yesterdaySlip.length > 0) {
        // Use yesterday's closing stock as today's opening stock
        yesterdaySlip.forEach(item => {
          const category = item.category || determineCategory(item.name);
          addRow(category, {
            name: item.name,
            size: item.size,
            cost: item.cost,
            selling: item.selling,
            open: item.close || '0',
            added: '',
            sold: '',
            close: '',
            sales: '',
            profit: ''
          });
        });
        
        logActivity(`New slip created with yesterday's closing stock`);
      } else {
        // If no yesterday's slip, add current inventory products
        products.forEach(product => {
          const category = product.category || determineCategory(product.name);
          addRow(category, {
            name: product.name,
            size: product.size,
            cost: product.price * 0.8, // Assuming 20% margin
            selling: product.price,
            open: product.stock || '0',
            added: '',
            sold: '',
            close: product.stock || '0',
            sales: '',
            profit: ''
          });
        });
        
        logActivity("New slip created with current inventory products");
      }
      
      // Set today's date
      document.getElementById('reportDate').value = todayStr;
      
      alert(`New slip created for ${todayStr}. ${yesterdaySlip.length > 0 ? 
            "Yesterday's closing stock loaded as today's opening stock." : 
            "Current inventory products loaded."}`);
    }

    // Add new product (admin only)
    function addNewProduct() {
      const name = document.getElementById("newProductName").value.trim();
      const size = document.getElementById("newProductSize").value.trim();
      const cost = document.getElementById("newProductCost").value.trim();
      const selling = document.getElementById("newProductSelling").value.trim();
      
      if (!name) {
        alert("Please enter a product name");
        return;
      }
      
      // Determine category based on product name
      const category = determineCategory(name);
      
      // Add to admin products
      const newProduct = {
        name: name,
        size: size,
        cost: cost,
        selling: selling,
        category: category
      };
      
      adminProducts.push(newProduct);
      localStorage.setItem("adminProducts", JSON.stringify(adminProducts));
      
      // Add to current slip
      addRow(category, {
        name: name,
        size: size,
        cost: cost,
        selling: selling,
        open: '0',
        added: '',
        sold: '',
        close: '0',
        sales: '',
        profit: ''
      });
      
      // Add to products inventory
      const newInventoryItem = {
        id: `${name}-${size || 'standard'}`.toLowerCase().replace(/\s+/g, '-'),
        name: name,
        size: size || '',
        price: parseFloat(selling) || 0,
        stock: 0,
        minStock: 5,
        category: category
      };
      
      products.push(newInventoryItem);
      localStorage.setItem('products', JSON.stringify(products));
      
      // Clear form
      document.getElementById("newProductName").value = "";
      document.getElementById("newProductSize").value = "";
      document.getElementById("newProductCost").value = "";
      document.getElementById("newProductSelling").value = "";
      
      // Update inventory view if open
      if (document.getElementById("inventoryContainer").style.display === "block") {
        loadInventory();
      }
      
      logActivity(`Admin added new product: ${name}${size ? ' ('+size+')' : ''}`);
    }

    // Add row to stock table in specified category
    function addRow(category, data = {}) {
      const tbody = document.getElementById(`${category}TableBody`);
      const tr = document.createElement("tr");
      
      // Delete button (hidden for employee)
      const deleteCell = document.createElement("td");
      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-btn";
      deleteBtn.innerHTML = "<i class='fas fa-trash'></i>";
      deleteBtn.onclick = function() {
        if (!currentUser.isAdmin) {
          alert("Employees cannot delete products. Please contact admin.");
          return;
        }
        if (confirm("Are you sure you want to delete this product?")) {
          const name = tr.querySelector(".name").value;
          const size = tr.querySelector(".size").value;
          tr.remove();
          updateProductList();
          logActivity(`Deleted product: ${name}${size ? ' ('+size+')' : ''}`);
        }
      };
      
      if (!currentUser.isAdmin) {
        deleteBtn.style.display = 'none';
      }
      deleteCell.appendChild(deleteBtn);
      tr.appendChild(deleteCell);
      
      // Product cells
      ["name","size","cost","selling","open","added","total","sold","close","sales","profit"].forEach((key, i) => {
        const td = document.createElement("td");
        const input = document.createElement("input");
        input.type = i === 0 || i === 1 ? "text" : "number";
        input.className = key;
        input.value = data[key] || "";
        input.min = "0";
        input.step = "0.01";
        
        if (["total", "close", "sales", "profit"].includes(key)) {
          input.readOnly = true;
          input.style.backgroundColor = "#f0f4f8";
          input.style.color = "#4a5568";
        }
        
        // Make product details readonly for employee
        if (!currentUser.isAdmin && ['name', 'size', 'cost', 'selling'].includes(key)) {
          input.readOnly = true;
          input.style.backgroundColor = "#f0f4f8";
          input.style.color = "#4a5568";
        }
        
        input.oninput = () => updateRow(input);
        td.appendChild(input);
        tr.appendChild(td);
      });
      
      // Add category as data attribute to prevent moving between categories
      tr.dataset.category = category;
      
      tbody.appendChild(tr);
      
      // Animate the new row
      tr.style.opacity = '0';
      tr.style.transform = 'translateY(20px)';
      setTimeout(() => {
        tr.style.opacity = '1';
        tr.style.transform = 'translateY(0)';
      }, 100);
    }

    // Update row calculations
    function updateRow(input) {
      const row = input.closest("tr");
      const cost = parseFloat(row.querySelector(".cost").value) || 0;
      const selling = parseFloat(row.querySelector(".selling").value) || 0;
      const open = parseFloat(row.querySelector(".open").value) || 0;
      const added = parseFloat(row.querySelector(".added").value) || 0;
      const sold = parseFloat(row.querySelector(".sold").value) || 0;

      const total = open + added;
      const closing = total - sold;
      const totalSales = sold * selling;
      const profit = sold * (selling - cost);

      row.querySelector(".total").value = total.toFixed(2);
      row.querySelector(".close").value = closing.toFixed(2);
      row.querySelector(".sales").value = totalSales.toFixed(2);
      row.querySelector(".profit").value = profit.toFixed(2);
      
      updateProductList();
    }

    // Update product list in localStorage
    function updateProductList() {
      const updatedProducts = [];
      const categories = ['beers', 'wines', 'spirits', 'softDrinks', 'others'];
      
      categories.forEach(category => {
        const rows = document.querySelectorAll(`#${category}TableBody tr`);
        
        rows.forEach(row => {
          const name = row.querySelector(".name").value;
          const size = row.querySelector(".size").value;
          const selling = row.querySelector(".selling").value;
          const closing = row.querySelector(".close").value;
          
          if (name) {
            // Find existing product to preserve minStock and category
            const existingProduct = products.find(p => 
              p.name === name && (p.size || '') === (size || ''));
              
            updatedProducts.push({
              id: `${name}-${size || 'standard'}`.toLowerCase().replace(/\s+/g, '-'),
              name: name,
              size: size || '',
              price: parseFloat(selling) || 0,
              stock: parseInt(closing) || 0,
              minStock: existingProduct ? existingProduct.minStock : 5,
              category: existingProduct ? existingProduct.category : determineCategory(name)
            });
          }
        });
      });

      products = updatedProducts;
      localStorage.setItem('products', JSON.stringify(products));
      
      // Update inventory view if open
      if (document.getElementById("inventoryContainer").style.display === "block") {
        loadInventory();
      }
      
      // Update payment products if open
      if (document.getElementById("paymentContainer").style.display === "block") {
        loadPaymentProducts();
      }
    }

    // Save slip to localStorage
    function saveSlip() {
      const date = document.getElementById("reportDate").value;
      
      // Combine all rows from all categories
      const slipData = [];
      const categories = ['beers', 'wines', 'spirits', 'softDrinks', 'others'];
      
      categories.forEach(category => {
        const rows = document.querySelectorAll(`#${category}TableBody tr`);
        
        rows.forEach(row => {
          const data = {};
          row.querySelectorAll("input").forEach(input => {
            data[input.className] = input.value;
          });
          data.category = category; // Store category to prevent moving between categories
          slipData.push(data);
        });
      });
      
      savedSlips[date] = slipData;
      localStorage.setItem("savedSlips", JSON.stringify(savedSlips));
      updateProductList();
      
      alert("Slip saved for " + date);
      logActivity("Stock slip saved");
    }

    // Load slip from localStorage
    function loadSlip(date) {
      // Clear all tables
      document.getElementById('beersTableBody').innerHTML = '';
      document.getElementById('winesTableBody').innerHTML = '';
      document.getElementById('spiritsTableBody').innerHTML = '';
      document.getElementById('softDrinksTableBody').innerHTML = '';
      document.getElementById('othersTableBody').innerHTML = '';
      
      const slip = savedSlips[date] || [];
      
      if (slip && slip.length) {
        // Load saved slip data into appropriate categories
        slip.forEach(item => {
          const category = item.category || determineCategory(item.name);
          addRow(category, item);
        });
      } else {
        // If no slip for this date, load current inventory
        products.forEach(product => {
          const category = product.category || determineCategory(product.name);
          addRow(category, {
            name: product.name,
            size: product.size,
            cost: product.price * 0.8, // Assuming 20% margin
            selling: product.price,
            open: product.stock || '0',
            added: '',
            sold: '',
            close: product.stock || '0',
            sales: '',
            profit: ''
          });
        });
      }
    }

    // Export to CSV
    function exportCSV() {
      const date = document.getElementById("reportDate").value;
      let csv = "Category,Product Name,Size,Cost Price,Selling Price,Opening Stock,Added Items,Total Available,Sold,Closing Stock,Total Sales,Profit\n";
      
      const categories = [
        { id: 'beers', name: 'Beers' },
        { id: 'wines', name: 'Wines' },
        { id: 'spirits', name: 'Spirits' },
        { id: 'softDrinks', name: 'Soft Drinks' },
        { id: 'others', name: 'Others' }
      ];
      
      categories.forEach(category => {
        const rows = document.querySelectorAll(`#${category.id}TableBody tr`);
        
        rows.forEach(row => {
          const values = [category.name];
          const inputs = Array.from(row.querySelectorAll("input"));
          inputs.forEach(input => {
            values.push(input.value);
          });
          csv += values.join(",") + "\n";
        });
      });
      
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `Stock_Report_${date}.csv`;
      link.click();
      
      logActivity("Exported stock report to CSV");
    }

    // Show daily sales report
    function showDailySales() {
      const today = document.getElementById("reportDate").value;
      const slip = savedSlips[today] || [];
      const modal = document.getElementById('salesModal');
      const dateDisplay = document.getElementById('salesReportDate');
      const tableBody = document.getElementById('salesTableBody');
      
      dateDisplay.textContent = `Date: ${today}`;
      tableBody.innerHTML = '';
      
      let grandTotal = 0;
      
      slip.forEach(item => {
        const sold = parseFloat(item.sold) || 0;
        const sellingPrice = parseFloat(item.selling) || 0;
        const totalSales = sold * sellingPrice;
        
        if (sold > 0) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.size || ''}</td>
            <td>${sold}</td>
            <td>${sellingPrice.toFixed(2)}</td>
            <td>${totalSales.toFixed(2)}</td>
            <td>
              <button onclick="initiateReturn('${item.name}', '${item.size || ''}', ${sold}, ${sellingPrice})" 
                      class="btn btn-danger" style="padding: 0.5rem;">
                <i class="fas fa-undo"></i> Return
              </button>
            </td>
          `;
          tableBody.appendChild(row);
          grandTotal += totalSales;
        }
      });
      
      document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
      modal.style.display = 'flex';
      
      // Set current view and show back button
      currentView = 'salesReport';
      showBackButton();
      
      logActivity("Viewed daily sales report");
    }
    
    function closeSalesModal() {
      document.getElementById('salesModal').style.display = 'none';
      hideBackButton();
    }

    // Initiate return process
    function initiateReturn(name, size, maxQty, price) {
      currentReturnItem = { name, size, maxQty, price };
      
      document.getElementById('returnProductName').textContent = name;
      document.getElementById('returnProductSize').textContent = size || 'N/A';
      document.getElementById('returnProductPrice').textContent = price.toFixed(2) + ' Ksh';
      document.getElementById('returnProductQty').textContent = maxQty;
      document.getElementById('returnQty').max = maxQty;
      document.getElementById('returnQty').value = 1;
      
      // Clear any selected reason
      document.querySelectorAll('.return-reason-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('returnNotes').value = '';
      
      // Show return modal
      document.getElementById('returnModal').style.display = 'flex';
    }

    // Close return modal
    function closeReturnModal() {
      document.getElementById('returnModal').style.display = 'none';
      currentReturnItem = null;
    }

    // Process return
    function processReturn() {
      if (!currentReturnItem) return;
      
      const returnQty = parseInt(document.getElementById('returnQty').value) || 0;
      if (returnQty <= 0 || returnQty > currentReturnItem.maxQty) {
        alert(`Please enter a valid quantity between 1 and ${currentReturnItem.maxQty}`);
        return;
      }
      
      const selectedReasonBtn = document.querySelector('.return-reason-btn.active');
      if (!selectedReasonBtn) {
        alert('Please select a reason for return');
        return;
      }
      
      const reason = selectedReasonBtn.dataset.reason;
      const notes = document.getElementById('returnNotes').value;
      
      // Find the product in inventory and update stock
      const productIndex = products.findIndex(p => 
        p.name === currentReturnItem.name && 
        (p.size || '') === (currentReturnItem.size || '')
      );
      
      if (productIndex >= 0) {
        products[productIndex].stock = (products[productIndex].stock || 0) + returnQty;
        localStorage.setItem('products', JSON.stringify(products));
        
        // Update inventory view if open
        if (document.getElementById("inventoryContainer").style.display === "block") {
          loadInventory();
        }
        
        // Update stock taking view if open
        if (document.getElementById("stockForm").style.display === "block") {
          loadSlip(document.getElementById("reportDate").value);
        }
      }
      
      // Record the return
      const today = new Date().toISOString().split('T')[0];
      const returns = JSON.parse(localStorage.getItem("returns")) || {};
      
      if (!returns[today]) {
        returns[today] = [];
      }
      
      returns[today].push({
        name: currentReturnItem.name,
        size: currentReturnItem.size,
        quantity: returnQty,
        price: currentReturnItem.price,
        reason: reason,
        notes: notes,
        timestamp: new Date().toISOString(),
        processedBy: currentUser.username
      });
      
      localStorage.setItem("returns", JSON.stringify(returns));
      
      // Show success message
      alert(`Return processed successfully for ${returnQty} ${currentReturnItem.name}${currentReturnItem.size ? ' ('+currentReturnItem.size+')' : ''}`);
      
      // Close modal and refresh sales report
      closeReturnModal();
      showDailySales();
      
      logActivity(`Processed return for ${returnQty} ${currentReturnItem.name}${currentReturnItem.size ? ' ('+currentReturnItem.size+')' : ''}, reason: ${reason}`);
    }

    // Set up return reason buttons
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.return-reason-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.return-reason-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
    });

    // Activity log functions
    function logActivity(message) {
      const logContent = document.getElementById('activityLogContent');
      const timestamp = new Date().toLocaleTimeString();
      const logItem = document.createElement('div');
      logItem.className = 'activity-item';
      logItem.innerHTML = `<i class="fas fa-circle"></i> [${timestamp}] ${message}`;
      logContent.insertBefore(logItem, logContent.firstChild);
      
      // Keep only the last 10 activities
      if (logContent.children.length > 10) {
        logContent.removeChild(logContent.lastChild);
      }
      
      // Show notification badge if log is closed
      const activityLog = document.getElementById('activityLog');
      if (!activityLog.classList.contains('active')) {
        const toggleBtn = document.querySelector('.activity-log-toggle');
        let badge = toggleBtn.querySelector('.notification-badge');
        
        if (!badge) {
          badge = document.createElement('span');
          badge.className = 'notification-badge';
          badge.textContent = '1';
          toggleBtn.appendChild(badge);
        } else {
          const currentCount = parseInt(badge.textContent) || 0;
          badge.textContent = currentCount + 1;
        }
      }
    }

    // Initialize the system when page loads
    window.addEventListener('load', initializeSystem);
  </script>
</body>
</html>
